# План реструктуризации архитектуры приложения LLM-UI

## Текущее состояние проекта

Проект представляет собой веб-приложение на основе FastAPI, где бэкенд отвечает и за логику обработки данных, и за отображение UI через шаблоны Jinja2. Основные компоненты:

- Фронтенд: HTML-шаблоны (Jinja2) + статические файлы
- Бэкенд: FastAPI маршруты, возвращающие преимущественно TemplateResponse
- База данных: SQLAlchemy ORM модели
- Сервисы: OllamaService для взаимодействия с LLM

## Цели реструктуризации

1. Явное разделение фронтенд и бэкенд частей
2. Разделение API-методов на две категории:
   - Методы, возвращающие TemplateResponse (для текущего фронтенда)
   - Методы, возвращающие JSON (для API и будущего независимого фронтенда)
3. Обеспечение плавного перехода на архитектуру с отдельным фронтенд-приложением

## Этапы реализации

### ✅ Этап 1: Реорганизация структуры проекта (ЗАВЕРШЕНО)

1. **Создание структуры каталогов**
   - `app/api/` - Для API-эндпоинтов, возвращающих JSON
   - `app/views/` - Для эндпоинтов, возвращающих TemplateResponse

2. **Перемещение моделей и схем**
   - Обновлены Pydantic-модели в `app/schemas/`
   - Разделены схемы запросов и ответов для лучшей документации API

**Результаты этапа 1:**
- Создана структура каталогов для API и веб-представлений
- Созданы основные сервисы (ChatService, ModelService, TemplateService)
- Реализованы API-эндпоинты для чатов, моделей и шаблонов промптов
- Созданы схемы данных для API
- Добавлены первые веб-маршруты, использующие сервисный слой

### Этап 2: Рефакторинг маршрутов

1. **Доработка API-эндпоинтов**
   - Тестирование и отладка API-эндпоинтов
   - Устранение проблем с маршрутизацией
   - Добавление подробной документации к API

2. **Реорганизация маршрутов для веб-представлений**
   - Создать веб-маршруты для моделей и шаблонов промптов
   - Перенести оставшуюся логику из существующих контроллеров в сервисы
   - Методы должны использовать API-слой для получения данных

### Этап 3: Разделение бизнес-логики

1. **Оптимизация слоя сервисов**
   - Рефакторинг сервисов для повышения переиспользуемости
   - Добавление обработки ошибок и валидации данных
   - Покрытие сервисов тестами

2. **Оптимизация взаимодействия с базой данных**
   - Создать репозиторий-слой для работы с БД
   - Вынести логику доступа к данным из моделей в репозитории

### Этап 4: Реализация API-документации и тестов

1. **Улучшение документации API**
   - Добавить детальное описание всех API-эндпоинтов
   - Использовать возможности FastAPI для автоматической документации

2. **Создание тестов для API**
   - Написать тесты для всех API-эндпоинтов
   - Обеспечить высокое покрытие тестами

### Этап 5: Подготовка к переходу на отдельный фронтенд

1. **Настройка CORS**
   - Улучшить настройку CORS-политик для поддержки отдельного фронтенд-приложения

2. **Реализация аутентификации и авторизации**
   - Добавить поддержку токенов доступа для API-эндпоинтов
   - Реализовать механизмы безопасности для API

## Тестирование и внедрение

1. **Параллельное тестирование**
   - Обеспечить работу обоих интерфейсов (шаблоны и API) во время разработки
   - Проверить совместимость всех функций в обоих вариантах

2. **Постепенное внедрение**
   - Внедрять изменения поэтапно, сохраняя работоспособность приложения
   - Тестировать каждый компонент после внедрения

## Дополнительные рекомендации

1. **Документирование кода**
   - Улучшить документацию кода для облегчения дальнейшей разработки и поддержки

2. **Использование зависимостей FastAPI**
   - Оптимизировать использование системы зависимостей FastAPI для внедрения сервисов

3. **Подготовка примеров использования API**
   - Создать примеры использования API для разработчиков фронтенда 